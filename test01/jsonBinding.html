<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="content-language" content="ko">
<meta name="language" content="ko">
<meta property="og:url" content="http://test.tst">
<meta property="og:title" content="타이틀">
<meta property="og:type" content="website">
<meta property="og:description" content="테스트 홈피.">
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
<meta name="Author" content="">
<meta name="copyright" content="(c)2021">
<meta name="Robots" content="ALL">
<meta name="keywords" content="키워드">
<meta name="description" content="설명">
<title></title>

<link rel="stylesheet" type="text/css" href="../css/common.css">
<script type="text/javascript" id="wiget" src="../as/load_as.js" async=""></script>


<script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>

<script type="text/javascript" src="../lib/LDebug.js"></script>


<script type="text/javascript">


// json Data binding


const DBinder = (()=>{
	
	//const doc_ = document;
	//const eId_ = document.getElementById;		//document가 생성되기전에 호출됨

	const testCount_ = 10;
	
		
	function tagBind_(id, data){	// id: div id=
		L_(" id:" + id);
		let d = document.getElementById(id);
		let c = d.childNodes||null;
		if(c != null){
			for(let i=0;i<c.length;i++){
				searchDataFor_(i, d.childNodes[i], 0, data);  // idx, obj, level
			}
		}
	}
	
	
	// test

	let dataObj = {aaa: "AAAA", bbb: "bbbb", ccc: "cccc", ddd: "dddd"};

	//
	function nodeInfo_(idx, node, level){
		
		L_( node.nodeName );
		if(node.nodeName == "#text"){
			
			return;
		}
		L_("{level:" + level + " idx::" + idx + " nodeType:" + node.nodeType + " tagName:" + node.tagName);
		L_(node);
		L_("  attr bind:" + node.getAttribute("data-bind")||null);
		L_("  attr data-for:" + node.getAttribute("data-for")||null);
		L_("}");
		
	}


	//
	// attr 중 data-for 를 갯수만큼 생성 해주는 기능
	function searchDataFor_(idx, node, level, data){
			
		//
		//nodeInfo_(idx, node, level);
		
		// do action
		if(node.nodeName == "#text"){
			return;
		}	
			

		if(node.hasAttribute("data-bind-for")){

			//
			let forData = node.getAttribute("data-bind-for");
			L_(forData);


			node.removeAttribute("data-bind-for");
			node.removeAttribute("data-bind-for");
			
			
			let newNode = null;
			
			
			// 생성
			for(let ii=0;ii<5;ii++){		//test
				newNode = node.cloneNode(true);  // deep copy
				newNode.removeAttribute("data-bind-for");		//

				newNode.setAttribute("data-bind-idx", ii);
				newNode.setAttribute("data-bind-item", dataObj);  //obj 들어갈수 있는가??? - 안됨.
				node.parentNode.append(newNode);		//	
			}
			node.remove();
		}

		

		if(node.hasChildNodes()){  // has Child가 있으면
			let level_ = level+1;
			for(let j=0;j<node.childNodes.length;j++){
				searchDataFor_(j, node.childNodes[j], level_, data);
			}
		}
		
	}



	return {
	
		tagBind: function(id, data){

			tagBind_(id, data);
		}		
	}


})();




//
document.addEventListener("DOMContentLoaded", function(){  //$(document).ready() 동일한 기능
	L_("Load...");
	
	loadDebug();	


	//
	function loadDebug(){
		
		btnTest("[data-for생성]", (e)=>{
			L_("{{{");
			DBinder.tagBind("addDiv", {});
		});

		btnTest("[getData]", (e)=>{
			let item = $("#addDiv > div > span:nth-child(1)");
			L_(item);
			let data = $(item).attr("data-bind-item");
			L_(data);

			let r = {aa:"aaaa"};
			L_(r
			);

		});
		
	}

});	


</script>


</head>


<body>


	<noscript>
	<iframe src="../include/ns.html?id=DateTime" height="0" width="0" style="display:none;visibility:hidden"></iframe>
	</noscript>


	<div id="wrap">
		<div id="_DEBUG_"></div>
	<div>

	<hr/>

	<hr/>

	<div id="addDiv">
		<div>
			<span data-bind-for="data.code.list" href="#">{{T1}}</span>[]
		</div>
	</div>


</body>
</html>